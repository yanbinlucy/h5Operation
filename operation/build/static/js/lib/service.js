define("lib/service",["./common"],function(a){jQuery.noConflict();var b={send:function(a){this.ajax(a)},ajax:function(b){var c=b.data,d=new FormData,e="",f="",g=window.event||arguments[0];g&&(f=g.target,e=$(f).attr("id"));for(var h in c)d.append(h,c[h]);$.ajax({url:b.url,type:b.type||"POST",data:d,async:b.async||!0,cache:b.cache||!1,contentType:!1,processData:!1,dataType:b.dataType||"json",beforeSend:function(a,b){e&&($(f).addClass("status-disabled"),$(f).attr("id","")),a.setRequestHeader("X-CSRFToken",$.fn.cookie("csrftoken"))},success:function(a){e&&($(f).removeClass("status-disabled"),$(f).attr("id",e)),b.scope?b.callback&&b.callback.call(b.scope,a):b.callback&&b.callback(a)},error:function(b,c,d){e&&($(f).removeClass("status-disabled"),$(f).attr("id",e));var g="";try{g=$.parseJSON(b.response)}catch(h){g=""}if(g){var i=g.detail,j="";if("string"==typeof i)j=i;else for(var k in i)"成功"!=i[k]&&(j=i[k]);a.showTip(j,$(".form-tip"))}else a.showTip("请求失败",$(".form-tip"))}})}},c=function(b){$.ajax({url:b.url,type:b.type||"Post",data:b.data.data,async:b.async||!0,dataType:b.dataType||"json",contentType:!1,processData:!1,beforeSend:function(a,c){if(a.setRequestHeader("X-CSRFToken",$.fn.cookie("csrftoken")),b.data.target&&"upload"==b.data.target){var d='<li id="loadingImg"><div><img src="/static/images/common/loading-img.gif" /></div></li>';$(".last-li").length>0&&$(d).insertBefore(".last-li")}},success:function(c){b.scope?b.callback&&b.callback.call(b.scope,c):b.callback&&b.callback(c);var d=c.detail;if(d){var e="";if("string"==typeof d)e=d;else for(var f in d)"成功"!=d[f]&&(e=d[f]);a.showTip(e,$(".form-tip"))}},error:function(a,b,c){}})},d=function(a){var b=new XMLHttpRequest;b.addEventListener("load",a.callback,!1),b.open("POST",a.url),b.setRequestHeader("Content-Type","multipart/form-data"),b.send(a.data)},e=function(a){$.ajax({url:a.url,type:a.type||"GET",data:a.data,async:a.async||!0,dataType:"json",contentType:a.contentType,success:function(b){a.scope?a.callback&&a.callback.call(a.scope,b):a.callback&&a.callback(b)},error:function(a,b,c){}})},f=function(a){};return{sendData:b,uploadFile:d,sendFile:c,normalAjax:e,localAjax:f}});